<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cryptocurrency Market Data</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .up {
            color: green;
        }
        .down {
            color: red;
        }
        .table-container {
            margin-top: 20px;
        }
        th {
            cursor: pointer;
        }
        th i {
            margin-left: 5px;
        }
    </style>
</head>
<body class="bg-light">

    <div class="container">
        <div class="text-center mt-5">
            <h1>Cryptocurrency Market Data</h1>
        </div>

        <div class="row mt-4 justify-content-center">
            <div class="col-auto">
                <p>Number of cryptocurrencies: <span id="crypto-count" class="fw-bold">0</span></p>
            </div>
            <div class="col-auto">
                <p id="total-market-cap" class="fw-bold">Total Market Cap: $0</p>
            </div>
        </div>

        <div class="table-container">
            <table class="table table-bordered table-striped table-hover" id="cryptoTable">
                <thead class="table-dark">
                    <tr>
                        <th onclick="sortTable(0)">Rank <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable(1)">Name <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable(2)">Market Cap <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable(3)">Price <i class="fas fa-sort"></i></th>
                        <th onclick="sortTable(4)">Change (24h) <i class="fas fa-sort"></i></th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be inserted here dynamically -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- FontAwesome for icons -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const apiUrl = 'https://sandbox-api.coinmarketcap.com/v1/cryptocurrency/listings/latest'; // URL of your Node.js server

        const fetchCryptocurrencyData = async () => {
            try {
                // Fetch data from the Node.js server
                const response = await fetch(apiUrl);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching cryptocurrency data:', error.message);
                throw error;
            }
        };

        const generateHTMLTable = (cryptoData) => {
            const tbody = document.querySelector('#cryptoTable tbody');
            let totalMarketCap = 0;
            let html = '';

            cryptoData.data.forEach((crypto, index) => {
                const marketCap = crypto.quote.USD.market_cap;
                const price = crypto.quote.USD.price.toFixed(2);
                const percentChange24h = crypto.quote.USD.percent_change_24h.toFixed(2);
                
                totalMarketCap += marketCap;

                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${crypto.name}</td>
                        <td>$${marketCap.toLocaleString()}</td>
                        <td>$${price}</td>
                        <td class="${percentChange24h >= 0 ? 'up' : 'down'}">${percentChange24h}%</td>
                    </tr>`;
            });

            tbody.innerHTML = html;
            document.getElementById('crypto-count').textContent = cryptoData.data.length;
            document.getElementById('total-market-cap').textContent = `Total Market Cap: $${totalMarketCap.toLocaleString()}`;
        };

        const main = async () => {
            try {
                const cryptoData = await fetchCryptocurrencyData();
                generateHTMLTable(cryptoData);
            } catch (error) {
                console.error('Failed to load cryptocurrency data:', error.message);
            }
        };

        main();

        let currentSortColumn = 0;
        let currentSortDir = 'asc';

        function sortTable(n) {
            const table = document.getElementById('cryptoTable');
            const rows = Array.from(table.rows).slice(1);
            const dataType = n === 2 || n === 3 || n === 4 ? 'number' : 'string'; // Sort numbers in columns Market Cap, Price, and Change (24h)

            rows.sort((rowA, rowB) => {
                const cellA = rowA.cells[n].textContent.replace(/[$,%]/g, '').trim();
                const cellB = rowB.cells[n].textContent.replace(/[$,%]/g, '').trim();
                let a = dataType === 'number' ? parseFloat(cellA) : cellA.toLowerCase();
                let b = dataType === 'number' ? parseFloat(cellB) : cellB.toLowerCase();

                if (currentSortDir === 'asc') {
                    return a > b ? 1 : -1;
                } else {
                    return a < b ? 1 : -1;
                }
            });

            currentSortDir = currentSortDir === 'asc' ? 'desc' : 'asc';
            currentSortColumn = n;

            const tbody = table.tBodies[0];
            rows.forEach(row => tbody.appendChild(row));

            updateSortIndicators();
        }

        function updateSortIndicators() {
            const indicators = document.querySelectorAll('th i');
            indicators.forEach(indicator => {
                indicator.className = 'fas fa-sort';
            });
            const indicator = indicators[currentSortColumn];
            if (currentSortDir === 'asc') {
                indicator.className = 'fas fa-sort-up';
            } else {
                indicator.className = 'fas fa-sort-down';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            updateSortIndicators();
        });
    </script>
</body>
</html>
